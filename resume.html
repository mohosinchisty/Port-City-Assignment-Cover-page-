<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ATS Friendly Resume Generator</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f2f5; }
.container { max-width:900px; margin:auto; padding:20px; }
h2,h3 { margin-top:15px; color:#333; }
input, textarea, select, button { width:100%; margin:5px 0; padding:8px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box; font-size:13px; }
button { background:#0073e6; color:#fff; border:none; cursor:pointer; font-weight:bold; transition:0.3s; }
button:hover { background:#005bb5; }
.entry { margin-bottom:8px; background:#fff; padding:8px; border-radius:6px; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
.page { width:210mm; min-height:297mm; padding:15mm; margin-top:20px; background:white; box-shadow:0 0 5px rgba(0,0,0,0.1); box-sizing:border-box; font-size:13px; line-height:1.3; }
.page h1 { text-align:center; font-size:26px; margin-bottom:2px; color:#0073e6; }
.page p.title { text-align:center; font-size:16px; margin-top:0; margin-bottom:10px; font-weight:bold; }
.page h2 { font-size:18px; margin-top:12px; color:#0073e6; }
.page p, .page li { font-size:13px; line-height:1.3; }
ul { padding-left:18px; margin-top:5px; margin-bottom:5px; }
@media print {
  body * { visibility: hidden; }
  #resumePreview, #resumePreview * { visibility: visible; }
  #resumePreview { position:absolute; left:0; top:0; width:100%; }
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html-docx-js/0.4.1/html-docx.min.js"></script>
</head>
<body>
<div class="container">
<h2>ATS Friendly Resume Generator</h2>

<input type="text" id="name" placeholder="Full Name">
<input type="text" id="title" placeholder="Educational Title">
<input type="text" id="email" placeholder="Email">
<input type="text" id="phone" placeholder="Phone">
<input type="text" id="linkedin" placeholder="LinkedIn">
<input type="text" id="location" placeholder="Location">
<textarea id="summary" placeholder="Professional Summary"></textarea>

<h3>Technical Skills</h3>
<div id="techSkills"><input type="text" placeholder="Add technical skill"></div>
<button onclick="addSkill('techSkills')">+ Add Technical Skill</button>

<h3>Soft Skills</h3>
<div id="softSkills"><input type="text" placeholder="Add soft skill"></div>
<button onclick="addSkill('softSkills')">+ Add Soft Skill</button>

<h3>Achievements</h3>
<div id="achievements"><input type="text" placeholder="Add achievement"></div>
<button onclick="addSkill('achievements')">+ Add Achievement</button>

<h3>Certifications</h3>
<div id="certifications"><input type="text" placeholder="Add certification"></div>
<button onclick="addSkill('certifications')">+ Add Certification</button>

<h3>Experience</h3>
<div id="experience"></div>
<button onclick="addExperience()">+ Add Experience</button>

<h3>Education</h3>
<div id="education"></div>
<button onclick="addEducation()">+ Add Education</button>

<button onclick="aiHelp()">AI Help</button>
<button onclick="updatePreview()">Generate Resume</button>
<button onclick="window.print()">Print Resume</button>
<button onclick="downloadDocx()">Download DOCX</button>

<div id="resumePreview"></div>

<script>
// Add skill dynamically
function addSkill(sectionId){
  const div=document.createElement("input");
  div.type="text"; div.placeholder="Add item";
  document.getElementById(sectionId).appendChild(div);
}

// Add experience with "Currently Working" checkbox
function addExperience(){
  const div=document.createElement("div"); div.className="entry";
  div.innerHTML=`<input type='text' placeholder='Job Title'>
                 <input type='text' placeholder='Company Name'>
                 <input type='month' placeholder='Start Date'>
                 <input type='month' placeholder='End Date'>
                 <label><input type='checkbox' class='currentJob' style='margin-right:5px;'> Currently Working</label>
                 <textarea placeholder='Responsibilities (one per line)'></textarea>`;
  const checkbox = div.querySelector(".currentJob");
  const endDateInput = div.querySelector("input[type='month']:nth-child(4)");
  checkbox.addEventListener("change", function(){
    if(this.checked){ endDateInput.disabled=true; endDateInput.value=""; } else { endDateInput.disabled=false; }
  });
  document.getElementById("experience").appendChild(div);
}

// Add education
function addEducation(){
  const div=document.createElement("div"); div.className="entry";
  div.innerHTML=`<input type='text' placeholder='Degree'>
                 <input type='text' placeholder='Institute'>
                 <input type='month' placeholder='Start Date'>
                 <input type='month' placeholder='End Date'>
                 <input type='number' placeholder='CGPA' step='0.01' min='0' max='5'>`;
  document.getElementById("education").appendChild(div);
}

// Fill sections
function fillSection(sectionId, arr){
  const container=document.getElementById(sectionId); container.innerHTML="";
  if(arr && arr.length){ arr.forEach(v=>{ const input=document.createElement("input"); input.type="text"; input.value=v; container.appendChild(input); }); }
}

// AI Help
async function aiHelp(){
  const eduTitle = document.getElementById("title").value.trim().toLowerCase();
  if(!eduTitle) return alert("Enter Educational Title");
  const baseURL = "https://raw.githubusercontent.com/YourUsername/YourRepo/main/resume-data/";
  const fileName = eduTitle.replace(/\s+/g,"_") + ".json";
  try{
    const response = await fetch(baseURL + fileName);
    if(!response.ok) return alert("No data found for this title on GitHub");
    const data = await response.json();
    document.getElementById("summary").value = data.summary || "";
    fillSection("techSkills", data.techSkills);
    fillSection("softSkills", data.softSkills);
    fillSection("achievements", data.achievements);
    fillSection("certifications", data.certifications);
    fillExperience(data.experience); fillEducation(data.education);
    updatePreview();
  }catch(err){ console.error(err); alert("Error fetching JSON from GitHub"); }
}

// Fill experience from JSON
function fillExperience(arr){
  const container=document.getElementById("experience"); container.innerHTML="";
  if(!arr) return;
  arr.forEach(e=>{
    const div=document.createElement("div"); div.className="entry";
    div.innerHTML=`<input type='text' placeholder='Job Title' value='${e.title||""}'>
                   <input type='text' placeholder='Company Name' value='${e.company||""}'>
                   <input type='month' placeholder='Start Date' value='${e.start||""}'>
                   <input type='month' placeholder='End Date' value='${e.end||""}'>
                   <label><input type='checkbox' class='currentJob' ${e.current?"checked":""} style='margin-right:5px;'> Currently Working</label>
                   <textarea placeholder='Responsibilities (one per line)'>${(e.responsibilities||[]).join("\n")}</textarea>`;
    const checkbox = div.querySelector(".currentJob");
    const endDateInput = div.querySelector("input[type='month']:nth-child(4)");
    checkbox.addEventListener("change", function(){
      if(this.checked){ endDateInput.disabled=true; endDateInput.value=""; } else { endDateInput.disabled=false; }
    });
    if(checkbox.checked) endDateInput.disabled=true;
    container.appendChild(div);
  });
}

// Fill education from JSON
function fillEducation(arr){
  const container=document.getElementById("education"); container.innerHTML="";
  if(!arr) return;
  arr.forEach(e=>{
    const div=document.createElement("div"); div.className="entry";
    let cgpaValue = e.cgpa || "";
    const deg = (e.degree || "").toLowerCase();
    if(deg.includes("hsc") || deg.includes("ssc")) cgpaValue = "5.00";
    div.innerHTML=`<input type='text' placeholder='Degree' value='${e.degree || ""}'>
                   <input type='text' placeholder='Institute' value='${e.institute || ""}'>
                   <input type='month' placeholder='Start Date' value='${e.start||""}'>
                   <input type='month' placeholder='End Date' value='${e.end||""}'>
                   <input type='number' placeholder='CGPA' step='0.01' min='0' max='5' value='${cgpaValue}'>`;
    container.appendChild(div);
  });
}

// Generate resume preview
function updatePreview(){
  function formatMonthYear(dateStr){ if(!dateStr) return ""; const date=new Date(dateStr); const options={ year:'numeric', month:'short'}; return date.toLocaleDateString('en-US', options);}
  let html=`<div class='page'>
            <h1>${document.getElementById("name").value}</h1>
            <p class="title">${document.getElementById("title").value}</p>
            <p>Email: ${document.getElementById("email").value}<br>
               Phone: ${document.getElementById("phone").value}<br>
               LinkedIn: ${document.getElementById("linkedin").value}<br>
               Location: ${document.getElementById("location").value}</p>
            <h2>Professional Summary</h2>
            <p>${document.getElementById("summary").value}</p>`;

  // Experience
  const exps=document.querySelectorAll("#experience .entry");
  if(exps.length){ html+="<h2>Experience</h2>";
    exps.forEach(e=>{
      const title=e.querySelector("input:nth-child(1)").value;
      const company=e.querySelector("input:nth-child(2)").value;
      const start=formatMonthYear(e.querySelector("input:nth-child(3)").value);
      const endInput = e.querySelector("input:nth-child(4)");
      const currentCheckbox = e.querySelector(".currentJob");
      const end = currentCheckbox && currentCheckbox.checked ? "Present" : formatMonthYear(endInput.value);
      const res=e.querySelector("textarea").value.split("\n").filter(Boolean);
      html+=`<div style="display:flex; justify-content:space-between;">
                <div style="text-align:left;">
                  <div><strong>${title}</strong></div>
                  <div>${company}</div>
                </div>
                <div style="text-align:right;">${start} - ${end}</div>
             </div>`;
      if(res.length){ html+="<ul>"; res.forEach(r=>html+=`<li>${r}</li>`); html+="</ul>"; }
    });
  }

  // Education
  const edus=document.querySelectorAll("#education .entry");
  if(edus.length){ html+="<h2>Education</h2>";
    edus.forEach(e=>{
      const deg=e.querySelector("input:nth-child(1)").value;
      const inst=e.querySelector("input:nth-child(2)").value;
      const start=formatMonthYear(e.querySelector("input:nth-child(3)").value);
      const end=formatMonthYear(e.querySelector("input:nth-child(4)").value);
      const cgpa=e.querySelector("input:nth-child(5)").value;
      html+=`<div style="display:flex; justify-content:space-between;">
                <div style="text-align:left;">
                  <div><strong>${deg}</strong></div>
                  <div>${inst}</div>
                </div>
                <div style="text-align:right;">${start} - ${end}</div>
             </div>`;
      if(cgpa) html+=`<p>CGPA: ${cgpa}</p>`;
    });
  }

  // Skills, Achievements, Certifications
  function sectionToHtml(id,title){
    const vals=[...document.querySelectorAll(`#${id} input`)].map(i=>i.value).filter(Boolean);
    if(vals.length){ html+=`<h2>${title}</h2><ul>`; vals.forEach(v=>html+=`<li>${v}</li>`); html+="</ul>"; }
  }
  sectionToHtml("techSkills","Technical Skills");
  sectionToHtml("softSkills","Soft Skills");
  sectionToHtml("achievements","Achievements");
  sectionToHtml("certifications","Certifications");

  html+="</div>";
  document.getElementById("resumePreview").innerHTML=html;
}

// Download DOCX
function downloadDocx(){
  const content = document.getElementById("resumePreview").innerHTML;
  const converted = htmlDocx.asBlob(`<!DOCTYPE html><html><body>${content}</body></html>`);
  saveAs(converted,"ATS-Friendly-Resume.docx");
}
</script>
</div>
</body>
</html>